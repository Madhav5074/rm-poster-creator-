<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Champions Club – Award Night Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: #0b1220; 
        }
        .container { 
            max-width: 550px; 
            margin: auto; 
        }
        canvas { 
            border-radius: 20px; 
            width: 100%; 
            box-shadow: 0 40px 100px rgba(0,0,0,0.6); 
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #d4af37;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body class="flex justify-center min-h-screen py-12 px-6 overflow-auto">

    <div class="container bg-white p-8 rounded-3xl shadow-2xl h-fit">

        <form id="posterForm" class="flex flex-col gap-5">
            <h1 class="text-3xl font-bold text-center text-blue-900 mb-2">
                Champions Club – Award Night
            </h1>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Upload RM Photo</label>
                <input type="file" id="rmPhoto" accept="image/*" required class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer border p-2 rounded">
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">RM Name</label>
                <input type="text" id="rmName" placeholder="Enter RM Name" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Designation</label>
                <select id="rmDesignation" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled selected>Select Designation</option>
                    <option value="RM">RM</option>
                    <option value="PB">PB</option>
                    <option value="PBA">PBA</option>
                    <option value="Others">Others</option>
                </select>
            </div>

            <div id="otherDesignationContainer" class="hidden">
                <label class="block text-sm font-semibold text-gray-700 mb-1">Specify Designation</label>
                <input type="text" id="otherDesignation" placeholder="Enter Designation" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Criteria Met</label>
                <select id="nliType" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled selected>Select Criteria</option>
                    <option value="NLI + LI Met">NLI + LI Met</option>
                    <option value="NLI Met">NLI Met</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Club Level</label>
                <select id="clubLevel" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled selected>Select Level</option>
                    <option value="Level 1">Level 1</option>
                    <option value="Level 2">Level 2</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Branch Name</label>
                <input type="text" id="branchName" placeholder="Enter Branch Name" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Cluster Name</label>
                <input type="text" id="clusterName" placeholder="Enter Cluster Name" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Premium Amount</label>
                <input type="text" id="premium" placeholder="Enter Premium Amount" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Product Type</label>
                <input type="text" id="productType" placeholder="Enter Product Type" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <button type="submit" class="mt-2 bg-blue-900 text-white p-3 rounded-lg font-bold hover:bg-blue-800 transition">
                Generate Poster
            </button>
        </form>

        <div id="loadingIndicator" class="hidden flex-col items-center gap-4 py-10">
            <div class="spinner"></div>
            <p class="text-gray-700 font-semibold">Generating your poster...</p>
        </div>

        <div id="resultContainer" class="hidden flex-col items-center gap-6">
            <canvas id="posterCanvas" width="1080" height="1350"></canvas>
            <button id="downloadBtn" class="w-full bg-yellow-500 text-black p-3 rounded-lg font-bold hover:bg-yellow-600 transition shadow-lg">
                Download Poster
            </button>
            <button id="resetBtn" class="w-full bg-gray-200 text-gray-800 p-3 rounded-lg font-bold hover:bg-gray-300 transition">
                Create Another
            </button>
        </div>

        <div class="mt-8 pt-4 border-t border-gray-200 text-center text-sm font-medium text-gray-400">
            <p>Version 3.0 | Copyright &copy; MADHAV KALRA</p>
        </div>

    </div>

    <script>
        const canvas = document.getElementById("posterCanvas");
        const ctx = canvas.getContext("2d");
        const form = document.getElementById("posterForm");
        const downloadBtn = document.getElementById("downloadBtn");
        const resetBtn = document.getElementById("resetBtn");
        const loadingIndicator = document.getElementById("loadingIndicator");
        const resultContainer = document.getElementById("resultContainer");

        const rmPhoto = document.getElementById("rmPhoto");
        const rmName = document.getElementById("rmName");
        const rmDesignation = document.getElementById("rmDesignation");
        const otherDesignationContainer = document.getElementById("otherDesignationContainer");
        const otherDesignation = document.getElementById("otherDesignation");
        const nliType = document.getElementById("nliType");
        const clubLevel = document.getElementById("clubLevel");
        const branchName = document.getElementById("branchName");
        const clusterName = document.getElementById("clusterName");
        const premiumInput = document.getElementById("premium");
        const productType = document.getElementById("productType");

        // Format currency
        premiumInput.addEventListener("input", function(){
            let value = this.value.replace(/[^0-9]/g,'');
            if(value){ 
                this.value = "₹" + Number(value).toLocaleString("en-IN"); 
            } else { 
                this.value = ""; 
            }
        });

        // Toggle Others designation
        rmDesignation.addEventListener("change", function(){
            if(this.value === "Others"){
                otherDesignationContainer.classList.remove("hidden");
                otherDesignation.required = true;
            } else {
                otherDesignationContainer.classList.add("hidden");
                otherDesignation.required = false;
                otherDesignation.value = "";
            }
        });

        // Reset Form to create another one
        resetBtn.addEventListener("click", function() {
            resultContainer.classList.add("hidden");
            resultContainer.classList.remove("flex");
            form.classList.remove("hidden");
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Helper function to load images safely
        const loadImage = (src) => {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = () => resolve(null); // Return null if missing, prevents breaking
                img.src = src;
            });
        };

        form.addEventListener("submit", function(e){
            e.preventDefault();

            if(!rmPhoto.files[0]){
                alert("Please upload an RM Photo");
                return;
            }

            form.classList.add("hidden");
            loadingIndicator.classList.remove("hidden");
            loadingIndicator.classList.add("flex");
            window.scrollTo({ top: 0, behavior: 'smooth' });

            const reader = new FileReader();
            reader.onload = async function(ev){
                
                const [profileImg, hdfcLogo, abLogo] = await Promise.all([
                    loadImage(ev.target.result),
                    loadImage('./assets/hdfc-logo.PNG'), 
                    loadImage('./assets/aditya-birla-logo.PNG') 
                ]);

                if (!hdfcLogo || !abLogo) {
                    let missing = [];
                    if(!hdfcLogo) missing.push("./assets/hdfc-logo.PNG");
                    if(!abLogo) missing.push("./assets/aditya-birla-logo.PNG");
                    alert("Missing files: " + missing.join(", ") + "\n\nPlease ensure these files exist in your 'assets' folder and the capitalization matches exactly (e.g., .png vs .PNG).");
                }

                let designation = rmDesignation.value === "Others" 
                    ? otherDesignation.value 
                    : rmDesignation.value;

                drawPoster(profileImg, hdfcLogo, abLogo, {
                    rmName: rmName.value.toUpperCase(),
                    designation: designation,
                    nli: nliType.value,
                    level: clubLevel.value,
                    branch: branchName.value,
                    cluster: clusterName.value,
                    premium: premiumInput.value,
                    product: productType.value
                });

                loadingIndicator.classList.add("hidden");
                loadingIndicator.classList.remove("flex");
                resultContainer.classList.remove("hidden");
                resultContainer.classList.add("flex");
            };
            reader.readAsDataURL(rmPhoto.files[0]);
        });

        function drawPoster(profile, hdfcLogo, abLogo, data){
            ctx.clearRect(0,0,1080,1350);

            /* Stage Gradient Background */
            const bg = ctx.createLinearGradient(0,0,0,1350);
            bg.addColorStop(0,"#000814");
            bg.addColorStop(0.4,"#001d3d");
            bg.addColorStop(1,"#000814");
            ctx.fillStyle = bg;
            ctx.fillRect(0,0,1080,1350);

            /* --- Draw Golden Sparkles in Background --- */
            ctx.save();
            for (let i = 0; i < 80; i++) {
                let x = Math.random() * 1080;
                let y = 160 + Math.random() * 1190; // Adjusted to start below the new header
                let radius = Math.random() * 3 + 1; 
                let opacity = Math.random() * 0.8 + 0.2; 
                
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 215, 0, ${opacity})`; 
                ctx.shadowBlur = Math.random() * 10 + 5;
                ctx.shadowColor = "white";
                ctx.fill();
            }
            ctx.restore();

            /* Top Header Bar */
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0,0,1080,160);

            /* Draw Logos Safely and Centered Vertically */
            if(hdfcLogo){
                let width = 200;
                let height = (hdfcLogo.naturalHeight / hdfcLogo.naturalWidth) * width;
                let yPos = (160 - height) / 2 + 15; 
                ctx.drawImage(hdfcLogo, 80, yPos, width, height);
            }

            if(abLogo){
                let width = 200;
                let height = (abLogo.naturalHeight / abLogo.naturalWidth) * width;
                let yPos = (160 - height) / 2 + 15; 
                ctx.drawImage(abLogo, 800, yPos, width, height);
            }

            /* Gold Gradient for text and frames */
            const gold = ctx.createLinearGradient(0,0,1080,0);
            gold.addColorStop(0,"#d4af37");
            gold.addColorStop(0.5,"#fff5b1");
            gold.addColorStop(1,"#d4af37");

            ctx.textAlign = "center";

            /* Title */
            let title = data.level === "Level 1" ? "BBH-Champions Club" : "GHMD-Champions Club";
            ctx.fillStyle = gold;
            ctx.font = "bold 78px Inter";
            ctx.fillText(title, 540, 260);

            /* Divider */
            ctx.fillStyle = "rgba(255,215,0,0.6)";
            ctx.fillRect(300, 280, 480, 3);

            /* NLI */
            ctx.fillStyle = "#ffffff";
            ctx.font = "bold 44px Inter";
            ctx.fillText(data.nli, 540, 330);

            /* Profile Image inside Circle */
            if(profile) {
                ctx.save();
                ctx.beginPath();
                ctx.arc(540, 600, 170, 0, Math.PI * 2);
                ctx.clip();

                let size = Math.min(profile.width, profile.height);
                let sourceX = (profile.width - size) / 2;
                let sourceY = (profile.height - size) / 2;
                
                ctx.drawImage(profile, sourceX, sourceY, size, size, 370, 430, 340, 340);
                ctx.restore();
            }

            /* Gold Frame around Profile */
            ctx.lineWidth = 10;
            ctx.strokeStyle = gold;
            ctx.beginPath();
            ctx.arc(540, 600, 170, 0, Math.PI * 2);
            ctx.stroke();

            /* Name */
            ctx.fillStyle = gold;
            ctx.font = "bold 56px Inter";
            ctx.fillText(data.rmName, 540, 900);

            /* Designation */
            ctx.font = "bold 34px Inter";
            ctx.fillText("(" + data.designation + ")", 540, 945);

            /* Branch and Cluster (Font size 32px) */
            ctx.fillStyle = "#ffffff";
            ctx.font = "32px Inter";
            ctx.fillText("Branch: " + data.branch + " | Cluster: " + data.cluster, 540, 1000);

            /* Premium Plate plate */
            ctx.fillStyle = "rgba(255,255,255,0.08)";
            ctx.fillRect(280, 1040, 520, 110);
            ctx.strokeStyle = "rgba(255,215,0,0.5)";
            ctx.lineWidth = 3;
            ctx.strokeRect(280, 1040, 520, 110);

            ctx.fillStyle = gold;
            ctx.font = "bold 80px Inter";
            ctx.fillText(data.premium, 540, 1120);

            /* Product (Font size 32px) */
            ctx.fillStyle = "#ffffff";
            ctx.font = "32px Inter";
            ctx.fillText("Product: " + data.product, 540, 1210);

            /* =========================================
               STYLISH GOLDEN BORDERS 
            ========================================= */
            ctx.save();

            // 1. Create a Metallic Gold Gradient for the borders
            const borderGold = ctx.createLinearGradient(0, 0, 1080, 1350);
            borderGold.addColorStop(0, "#b8860b");   // Dark Goldenrod
            borderGold.addColorStop(0.2, "#d4af37");  // Metallic Gold
            borderGold.addColorStop(0.4, "#ffd700");  // Bright Gold
            borderGold.addColorStop(0.6, "#fffacd");  // LemonChiffon highlight
            borderGold.addColorStop(0.8, "#d4af37");  // Metallic GoldBack
            borderGold.addColorStop(1, "#b8860b");    // Dark finish

            // Add a golden glow shadow to the borders
            ctx.shadowColor = "#d4af37";
            ctx.shadowBlur = 20;
            
            ctx.strokeStyle = borderGold;

            // 2. Draw Outer Thick Border (20px wide)
            const outerBorderWidth = 20;
            ctx.lineWidth = outerBorderWidth;
            // Offset by half the width so the stroke doesn't get cut off by canvas edge
            ctx.strokeRect(outerBorderWidth/2, outerBorderWidth/2, 1080 - outerBorderWidth, 1350 - outerBorderWidth);

            // 3. Draw Inner Thin Border (4px wide) to create a double-frame look
            const innerBorderWidth = 4;
            const gap = 12; // Gap between outer and inner border
            const offset = outerBorderWidth + gap;
            
            // Reduce shadow for inner border for cleaner look
            ctx.shadowBlur = 5; 
            ctx.lineWidth = innerBorderWidth;
            ctx.strokeRect(offset + innerBorderWidth/2, offset + innerBorderWidth/2, 1080 - (offset*2) - innerBorderWidth, 1350 - (offset*2) - innerBorderWidth);

            ctx.restore();
            /* ========================================= */
        }

        downloadBtn.addEventListener("click", function(){
            const link = document.createElement("a");
            link.download = "Champions_Club_Award_Night.png";
            link.href = canvas.toDataURL("image/png");
            link.click();
        });

    </script>
</body>
</html>
