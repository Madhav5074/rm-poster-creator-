<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aditya Birla Poster Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .container {
            max-width: 550px;
            margin: auto;
        }
        canvas {
            border: 2px solid #e2e8f0;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            height: auto;
            max-width: 1080px;
        }
        #posterCanvas, #downloadBtn, #loadingIndicator {
            display: none;
        }
        .version-number {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            font-size: 0.875rem;
            color: #9ca3af;
        }
        .copyright-text {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            font-size: 0.875rem;
            color: #9ca3af;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #0c4a6e;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">

    <div class="container bg-white p-10 rounded-3xl shadow-2xl flex flex-col gap-8">

        <form id="posterForm" class="flex flex-col gap-6">
            <h1 class="text-4xl font-extrabold text-center text-blue-900 mb-2">Create Your RM Poster</h1>

            <div>
                <label for="rmPhoto" class="block text-sm font-semibold text-gray-700 mb-2">Upload RM Photo</label>
                <input type="file" id="rmPhoto" accept="image/*" class="w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-full file:border-0
                    file:text-sm file:font-semibold
                    file:bg-blue-50 file:text-blue-700
                    hover:file:bg-blue-100 cursor-pointer">
            </div>
            
            <div>
                <label for="rmName" class="block text-sm font-semibold text-gray-700 mb-1">RM Name</label>
                <input type="text" id="rmName" placeholder="Enter RM Name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="rmDesignation" class="block text-sm font-semibold text-gray-700 mb-1">RM Designation</label>
                <select id="rmDesignation" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled selected>Select Designation</option>
                    <option value="RM">RM</option>
                    <option value="PB">PB</option>
                    <option value="PBA">PBA</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div id="otherDesignationContainer" style="display:none;">
                <label for="otherDesignation" class="block text-sm font-semibold text-gray-700 mb-1">Specify Other Designation</label>
                <input type="text" id="otherDesignation" placeholder="e.g., Senior Manager" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
                <label for="policyType" class="block text-sm font-semibold text-gray-700 mb-1">Policy Type</label>
                <select id="policyType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled selected>Select Policy Type</option>
                    <option value="Fresh">Fresh</option>
                    <option value="Renewal">Renewal</option>
                </select>
            </div>

            <div class="flex items-center gap-2">
                <input type="checkbox" id="bbhQualification" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                <label for="bbhQualification" class="text-sm font-semibold text-gray-700">BBH Inner Circle Qualification</label>
            </div>

            <div>
                <label for="bmName" class="block text-sm font-semibold text-gray-700 mb-1">Branch Manager Name</label>
                <input type="text" id="bmName" placeholder="Enter Branch Manager Name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="branchName" class="block text-sm font-semibold text-gray-700 mb-1">Branch Name</label>
                <input type="text" id="branchName" placeholder="Enter Branch Name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="clusterName" class="block text-sm font-semibold text-gray-700 mb-1">Cluster Name</label>
                <input type="text" id="clusterName" placeholder="Enter Cluster Name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="premium" class="block text-sm font-semibold text-gray-700 mb-1">Premium Amount</label>
                <input type="tel" id="premium" placeholder="Enter Premium Amount" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="productType" class="block text-sm font-semibold text-gray-700 mb-1">Product Type</label>
                <select id="productType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled selected>Select Product Type</option>
                    <option value="Active one">Active one</option>
                    <option value="Active Health V2">Active Health V2</option>
                </select>
            </div>
            
            <button type="submit" id="generateBtn" class="bg-gradient-to-r from-blue-600 to-blue-800 text-white font-bold py-3 rounded-lg shadow-lg hover:from-blue-700 hover:to-blue-900 transition duration-300 transform hover:scale-105">Generate Poster</button>
        </form>

        <div id="loadingIndicator" class="flex flex-col items-center gap-4">
            <div class="spinner"></div>
            <p class="text-gray-700 font-semibold">Generating...</p>
        </div>

        <div id="posterContainer" class="flex flex-col items-center gap-6">
            <canvas id="posterCanvas" width="1080" height="1350"></canvas>
            <button id="downloadBtn" class="bg-gradient-to-r from-green-600 to-green-800 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:from-green-700 hover:to-green-900 transition duration-300 transform hover:scale-105">Download Poster</button>
        </div>
        
    </div>
    
    <div class="version-number">
        Version 2.9
    </div>
    <div class="copyright-text">
        Copyright © MADHAV KALRA
    </div>

    <script>
        const posterForm = document.getElementById('posterForm');
        const posterCanvas = document.getElementById('posterCanvas');
        const ctx = posterCanvas.getContext('2d');
        const downloadBtn = document.getElementById('downloadBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const premiumInput = document.getElementById('premium');
        const rmDesignationSelect = document.getElementById('rmDesignation');
        const otherDesignationContainer = document.getElementById('otherDesignationContainer');
        const otherDesignationInput = document.getElementById('otherDesignation');
        const bbhQualificationCheckbox = document.getElementById('bbhQualification');
        
        const logoUrlAB = './assets/aditya-birla-logo.PNG';
        const logoUrlHDFC = './assets/hdfc-logo.PNG';

        premiumInput.addEventListener('input', function(event) {
            const value = this.value.replace(/[^0-9]/g, '');
            if (value) {
                this.value = `₹${Number(value).toLocaleString('en-IN')}`;
            } else {
                this.value = '';
            }
        });

        rmDesignationSelect.addEventListener('change', function() {
            if (this.value === 'Other') {
                otherDesignationContainer.style.display = 'block';
                otherDesignationInput.setAttribute('required', 'required');
            } else {
                otherDesignationContainer.style.display = 'none';
                otherDesignationInput.removeAttribute('required');
                otherDesignationInput.value = '';
            }
        });

        posterForm.addEventListener('submit', function(event) {
            event.preventDefault();

            const rmPhotoInput = document.getElementById('rmPhoto');
            const file = rmPhotoInput.files[0];
            
            if (!file) {
                showMessage("Please upload an RM photo.");
                return;
            }

            let rmDesignation = rmDesignationSelect.value;
            if (rmDesignation === 'Other') {
                rmDesignation = otherDesignationInput.value;
                if (!rmDesignation) {
                    showMessage("Please specify the other designation.");
                    return;
                }
            }
            
            posterForm.style.display = 'none';
            loadingIndicator.style.display = 'flex';

            const data = {
                rmName: document.getElementById('rmName').value,
                rmDesignation: rmDesignation,
                policyType: document.getElementById('policyType').value,
                isBbhQualified: bbhQualificationCheckbox.checked,
                bmName: document.getElementById('bmName').value,
                branchName: document.getElementById('branchName').value,
                clusterName: document.getElementById('clusterName').value,
                premium: document.getElementById('premium').value,
                productType: document.getElementById('productType').value
            };

            const reader = new FileReader();
            reader.onload = function(event) {
                const rmImage = new Image();
                rmImage.src = event.target.result;

                const logoAB = new Image();
                logoAB.src = logoUrlAB;

                const logoHDFC = new Image();
                logoHDFC.src = logoUrlHDFC;
                
                let loadedCount = 0;
                const totalToLoad = 3; 
                
                const checkIfLoaded = () => {
                    loadedCount++;
                    if (loadedCount === totalToLoad) {
                        drawPoster(rmImage, logoAB, logoHDFC, data);
                        loadingIndicator.style.display = 'none';
                        posterCanvas.style.display = 'block';
                        downloadBtn.style.display = 'block';
                    }
                };

                rmImage.onload = checkIfLoaded;
                logoAB.onload = checkIfLoaded;
                logoHDFC.onload = checkIfLoaded;
                
                rmImage.onerror = () => { console.error("RM image failed to load."); checkIfLoaded(); };
                logoAB.onerror = () => { console.error("Aditya Birla logo failed to load."); logoAB.src = ''; checkIfLoaded(); };
                logoHDFC.onerror = () => { console.error("HDFC logo failed to load."); logoHDFC.src = ''; checkIfLoaded(); };
            };
            reader.readAsDataURL(file);
        });

        function showMessage(message) {
            const container = document.querySelector('.container');
            let messageBox = document.createElement('div');
            messageBox.id = 'messageBox';
            messageBox.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50';
            messageBox.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl text-center flex flex-col items-center gap-4">
                    <p class="text-lg font-semibold text-gray-800">${message}</p>
                    <button onclick="this.parentNode.parentNode.style.display='none'" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
        }

        function drawStar(ctx, cx, cy, spikes, outerRadius, innerRadius, color) {
            let rot = Math.PI / 2 * 3;
            let x = cx;
            let y = cy;
            let step = Math.PI / spikes;

            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);
            for (i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;

                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }

        function drawPoster(rmImage, logoAB, logoHDFC, data) {
            const canvasWidth = 1080;
            const canvasHeight = 1350;
            posterCanvas.width = canvasWidth;
            posterCanvas.height = canvasHeight;

            const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);
            gradient.addColorStop(0, '#e8eff5');
            gradient.addColorStop(0.2, '#f5f8fa');
            gradient.addColorStop(1, '#ffffff');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);

            const logoMargin = 60;
            
            const hdfcLogoDesiredWidth = 280;
            let hdfcLogoActualHeight = 0;
            if (logoHDFC.complete && logoHDFC.naturalWidth > 0) {
                hdfcLogoActualHeight = (logoHDFC.naturalHeight / logoHDFC.naturalWidth) * hdfcLogoDesiredWidth;
            }
            if (hdfcLogoActualHeight > 0) {
                ctx.drawImage(logoHDFC, logoMargin, logoMargin, hdfcLogoDesiredWidth, hdfcLogoActualHeight);
            }

            const abLogoDesiredWidth = 230;
            let abLogoActualHeight = 0;
            if (logoAB.complete && logoAB.naturalWidth > 0) {
                abLogoActualHeight = (logoAB.naturalHeight / logoAB.naturalWidth) * abLogoDesiredWidth;
            }
            if (abLogoActualHeight > 0) {
                ctx.drawImage(logoAB, canvasWidth - abLogoDesiredWidth - logoMargin, logoMargin - 15, abLogoDesiredWidth, abLogoActualHeight);
            }

            ctx.textAlign = 'center';
            ctx.fillStyle = '#C20000';
            ctx.font = 'bolder 90px Inter, sans-serif';
            ctx.fillText("Congratulations!", canvasWidth / 2, 280);

            // Conditional text based on checkbox and policy type
            ctx.fillStyle = '#1a3263';
            ctx.font = 'bold 50px Inter, sans-serif';
            if (data.isBbhQualified) {
                ctx.fillText("BBH Inner Circle Qualification", canvasWidth / 2, 360);
            } else if (data.policyType === 'Fresh') {
                ctx.fillText("Fresh Health Champ (ABHI)", canvasWidth / 2, 360);
            } else {
                ctx.fillText("Health Champ (ABHI)", canvasWidth / 2, 360);
            }

            const imageSize = 380;
            const centerX = canvasWidth / 2;
            const centerY = 360 + 250;
            
            ctx.save();
            ctx.beginPath();
            ctx.arc(centerX, centerY, imageSize / 2, 0, Math.PI * 2);
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 15;
            ctx.fillStyle = '#ffffff';
            ctx.fill();
            ctx.restore();

            let sourceX = 0;
            let sourceY = 0;
            let sourceSize = Math.min(rmImage.width, rmImage.height);
            if (rmImage.width > rmImage.height) {
                sourceX = (rmImage.width - sourceSize) / 2;
            } else {
                sourceY = (rmImage.height - sourceSize) / 2;
            }

            ctx.save();
            ctx.beginPath();
            ctx.arc(centerX, centerY, imageSize / 2, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip();
            ctx.drawImage(rmImage, sourceX, sourceY, sourceSize, sourceSize, centerX - imageSize / 2, centerY - imageSize / 2, imageSize, imageSize);
            ctx.restore();

            // Draw Stars
            const starColor = '#FFC423';
            const starSpikes = 5;

            // Stars on the left
            drawStar(ctx, centerX - 250, centerY, starSpikes, 45, 20, starColor);
            drawStar(ctx, centerX - 330, centerY - 60, starSpikes, 35, 15, starColor);
            drawStar(ctx, centerX - 400, centerY + 30, starSpikes, 25, 10, starColor);

            // Stars on the right
            drawStar(ctx, centerX + 250, centerY, starSpikes, 45, 20, starColor);
            drawStar(ctx, centerX + 330, centerY - 60, starSpikes, 35, 15, starColor);
            drawStar(ctx, centerX + 400, centerY + 30, starSpikes, 25, 10, starColor);

            // Draw Gold Circle Border
            ctx.beginPath();
            ctx.arc(centerX, centerY, imageSize / 2, 0, Math.PI * 2);
            ctx.lineWidth = 18;
            ctx.strokeStyle = '#FFC423';
            ctx.stroke();

            ctx.textAlign = 'center';
            let currentY = centerY + imageSize / 2 + 80;
            
            ctx.fillStyle = '#1a3263';
            ctx.font = 'bold 52px Inter, sans-serif';
            ctx.fillText(`${data.rmName}`, canvasWidth / 2, currentY);

            // Draw the designation with a slight gap
            currentY += 50; // Increased this value for the gap
            ctx.font = 'bold 40px Inter, sans-serif';
            ctx.fillText(`(${data.rmDesignation})`, canvasWidth / 2, currentY);
            
            currentY += 50; // Adjusted for the next line

            ctx.font = 'bold 32px Inter, sans-serif';
            ctx.fillText(`Branch: ${data.branchName} | Cluster: ${data.clusterName}`, canvasWidth / 2, currentY);
            currentY += 90;
            
            const premiumText = `Premium : ${data.premium}`;
            ctx.font = 'bold 60px Inter, sans-serif';
            const premiumTextMetrics = ctx.measureText(premiumText);
            const premiumTextWidth = premiumTextMetrics.width;
            const boxPadding = 40;
            const boxWidth = premiumTextWidth + (boxPadding * 2);
            const boxHeight = 95;
            const boxX = (canvasWidth / 2) - (boxWidth / 2);
            const boxY = currentY - 70;

            ctx.fillStyle = '#FFDCDC';
            ctx.beginPath();
            ctx.roundRect(boxX, boxY, boxWidth, boxHeight, 15);
            ctx.fill();

            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.fillStyle = '#E70000';
            ctx.fillText(premiumText, canvasWidth / 2, currentY);
            currentY += 70;
            
            ctx.fillStyle = '#4a5568';
            ctx.font = '32px Inter, sans-serif';
            ctx.fillText(`Product Type: ${data.productType}`, canvasWidth / 2, currentY);
            currentY += 60;

            // Updated line to show BM name at the bottom
            ctx.font = '32px Inter, sans-serif';
            ctx.fillText(`Special thanks to Branch Manager`, canvasWidth / 2, currentY);
            currentY += 45;
            ctx.font = 'bold 36px Inter, sans-serif';
            ctx.fillText(`${data.bmName}`, canvasWidth / 2, currentY);
        }

        downloadBtn.addEventListener('click', function() {
            const imageDataUrl = posterCanvas.toDataURL('image/png');
            const downloadLink = document.createElement('a');
            downloadLink.href = imageDataUrl;
            downloadLink.download = `aditya-birla-poster.png`;
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        });
    </script>
</body>
</html>
