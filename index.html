<script>

const canvas = document.getElementById("posterCanvas");
const ctx = canvas.getContext("2d");
const form = document.getElementById("posterForm");
const downloadBtn = document.getElementById("downloadBtn");

const rmPhoto = document.getElementById("rmPhoto");
const rmName = document.getElementById("rmName");
const rmDesignation = document.getElementById("rmDesignation");
const otherDesignation = document.getElementById("otherDesignation");
const nliType = document.getElementById("nliType");
const clubLevel = document.getElementById("clubLevel");
const branchName = document.getElementById("branchName");
const clusterName = document.getElementById("clusterName");
const premiumInput = document.getElementById("premium");
const productType = document.getElementById("productType");

const trophyImg = new Image();
trophyImg.src = "./assets/trophy.png";

const hdfcLogo = new Image();
hdfcLogo.src = "./assets/hdfc-logo.PNG";

const abLogo = new Image();
abLogo.src = "./assets/aditya-birla-logo.PNG";

let shimmerOffset = 0;


/* ₹ formatting */
premiumInput.addEventListener("input", function(){
let value=this.value.replace(/[^0-9]/g,'');
if(value){ this.value="₹"+Number(value).toLocaleString("en-IN"); }
else{ this.value=""; }
});


/* Others designation toggle */
rmDesignation.addEventListener("change", function(){
if(this.value==="Others"){
otherDesignation.classList.remove("hidden");
otherDesignation.required=true;
}else{
otherDesignation.classList.add("hidden");
otherDesignation.required=false;
otherDesignation.value="";
}
});


form.addEventListener("submit", function(e){
e.preventDefault();

if(!rmPhoto.files[0]) {
alert("Please upload RM photo");
return;
}

const reader=new FileReader();

reader.onload=function(ev){
const img=new Image();
img.onload=function(){

let designation = rmDesignation.value==="Others"
? otherDesignation.value
: rmDesignation.value;

generatePoster(img,{
rmName: rmName.value.toUpperCase(),
designation,
nli: nliType.value,
level: clubLevel.value,
branch: branchName.value,
cluster: clusterName.value,
premium: premiumInput.value,
product: productType.value
});

form.style.display="none";
canvas.style.display="block";
downloadBtn.classList.remove("hidden");
};
img.src=ev.target.result;
};

reader.readAsDataURL(rmPhoto.files[0]);
});


function generatePoster(profile,data){

function draw(){

ctx.clearRect(0,0,1080,1350);

// Background gradient
const bgGrad = ctx.createLinearGradient(0,0,1080,1350);
bgGrad.addColorStop(0,"#061a2b");
bgGrad.addColorStop(0.5,"#0f3057");
bgGrad.addColorStop(1,"#000814");
ctx.fillStyle=bgGrad;
ctx.fillRect(0,0,1080,1350);

// Logos
if(hdfcLogo.complete)
ctx.drawImage(hdfcLogo,60,60,260,100);

if(abLogo.complete)
ctx.drawImage(abLogo,760,60,250,100);

// Gold shimmer gradient
const gold = ctx.createLinearGradient(shimmerOffset,0,shimmerOffset+300,0);
gold.addColorStop(0,"#FFD700");
gold.addColorStop(0.5,"#fff5b1");
gold.addColorStop(1,"#d4af37");

ctx.textAlign="center";

// Title
ctx.fillStyle=gold;
ctx.font="bold 80px Inter";

let title = data.level==="Level 1"
? "BBH-Champions Club"
: "GHMD-Champions Club";

ctx.fillText(title,540,250);

// NLI
ctx.fillStyle="#ffffff";
ctx.font="bold 48px Inter";
ctx.fillText(data.nli,540,330);

// Trophy PNG
if(trophyImg.complete){
ctx.drawImage(trophyImg,100,450,220,220);
ctx.drawImage(trophyImg,760,450,220,220);
}

// Spotlight glow
const spotlight = ctx.createRadialGradient(540,600,100,540,600,400);
spotlight.addColorStop(0,"rgba(255,215,0,0.4)");
spotlight.addColorStop(1,"rgba(255,215,0,0)");
ctx.fillStyle=spotlight;
ctx.fillRect(0,0,1080,1350);

// Profile circle
ctx.save();
ctx.beginPath();
ctx.arc(540,600,190,0,Math.PI*2);
ctx.clip();

let size=Math.min(profile.width,profile.height);
ctx.drawImage(profile,
(profile.width-size)/2,
(profile.height-size)/2,
size,size,
350,410,
380,380);
ctx.restore();

// Gold border
ctx.lineWidth=18;
ctx.strokeStyle=gold;
ctx.beginPath();
ctx.arc(540,600,190,0,Math.PI*2);
ctx.stroke();

// Name
ctx.fillStyle=gold;
ctx.font="bold 60px Inter";
ctx.fillText(data.rmName,540,900);

// Designation
ctx.font="bold 40px Inter";
ctx.fillText("("+data.designation+")",540,950);

// Branch
ctx.fillStyle="#ffffff";
ctx.font="30px Inter";
ctx.fillText("Branch: "+data.branch+" | Cluster: "+data.cluster,540,1005);

// Glass premium card
ctx.fillStyle="rgba(255,255,255,0.1)";
ctx.fillRect(240,1040,600,130);
ctx.strokeStyle="rgba(255,255,255,0.3)";
ctx.strokeRect(240,1040,600,130);

ctx.fillStyle=gold;
ctx.font="bold 95px Inter";
ctx.fillText(data.premium,540,1130);

// Product
ctx.fillStyle="#ffffff";
ctx.font="28px Inter";
ctx.fillText("Product: "+data.product,540,1200);

// Shimmer loop
shimmerOffset+=3;
if(shimmerOffset>1080) shimmerOffset=0;

requestAnimationFrame(draw);
}

draw();
}


downloadBtn.addEventListener("click",function(){
const link=document.createElement("a");
link.download="Champions_Club_V4_Ultra.png";
link.href=canvas.toDataURL("image/png");
link.click();
});

</script>